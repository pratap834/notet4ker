# Physician Notetaker ğŸ¥

> **AI-Powered Medical Transcript Analysis System**

A comprehensive medical NLP pipeline that transforms doctor-patient conversations into structured clinical documentation using state-of-the-art transformer models.

[![Python 3.11](https://img.shields.io/badge/python-3.11-blue.svg)](https://www.python.org/downloads/)
[![PyTorch](https://img.shields.io/badge/PyTorch-2.6+-red.svg)](https://pytorch.org/)
[![Transformers](https://img.shields.io/badge/ğŸ¤—-Transformers-yellow.svg)](https://huggingface.co/transformers/)
[![Deploy on Render](https://img.shields.io/badge/Deploy-Render-46E3B7.svg)](https://render.com)

## ğŸš€ Deploy Now

[![Deploy to Render](https://render.com/images/deploy-to-render-button.svg)](https://render.com/deploy)

[Full Deployment Guide](docs/DEPLOYMENT.md) | [Troubleshooting](docs/TROUBLESHOOTING.md) | [Web Interface Docs](docs/WEB_INTERFACE.md)

## ğŸ“‹ Table of Contents

- [Overview](#overview)
- [Features](#features)
- [Quick Start](#quick-start)
- [Deployment](#deployment)
- [Local Development](#local-development)
- [Usage](#usage)
- [Project Structure](#project-structure)
- [Models](#models)
- [Documentation](#documentation)
- [Contributing](#contributing)

## ğŸ¯ Overview

Physician Notetaker automates the extraction and structuring of medical information from clinical conversations. It uses production-grade transformer models to provide:

- **Named Entity Recognition (NER)** - Extract symptoms, diagnoses, treatments, medications
- **SOAP Note Generation** - Create structured clinical notes (Subjective, Objective, Assessment, Plan)
- **Clinical Summarization** - Generate concise, accurate medical summaries
- **Sentiment & Intent Analysis** - Understand conversation tone and purpose
- **FHIR Export** - Convert to HL7 FHIR R4 format for EHR integration

## âœ¨ Features

### Core Capabilities

âœ… **Medical Entity Extraction** - Identifies and categorizes medical terms with high accuracy
âœ… **Automated SOAP Notes** - Generates professional clinical documentation
âœ… **AI Summarization** - Produces clear, concise clinical summaries using FLAN-T5
âœ… **Sentiment Analysis** - Analyzes emotional tone using Clinical BERT
âœ… **Web Interface** - Modern, responsive UI for easy interaction
âœ… **GPU Acceleration** - Automatic CUDA support for faster processing
âœ… **REST API** - Easy integration with existing systems
âœ… **FHIR Compliant** - Exports data in healthcare standard format

### Technical Highlights

- **Production-Ready Models**: Uses biomedical-specific transformer models
- **No Hardcoded Rules**: All outputs generated by real AI inference
- **Modular Architecture**: Easy to extend and customize
- **Well Documented**: Comprehensive inline documentation and examples
- **Type Safe**: Full type hints throughout the codebase

## ğŸš€ Quick Start

### Prerequisites

- **Python**: 3.8 or higher
- **RAM**: 8GB minimum (16GB recommended)
- **GPU**: NVIDIA GPU with CUDA support (optional but recommended)
- **Storage**: 5GB for models
- **PyTorch**: 2.6.0 or higher (for security)
Option 1: Deploy to Cloud (Recommended)

Deploy to Render with one click - no local setup required!

[![Deploy to Render](https://render.com/images/deploy-to-render-button.svg)](https://render.com/deploy)

**Steps**:
1. Click the button above
2. Connect your GitHub repository
3. Wait 10-15 minutes for deployment
4. Access your app at `https://physician-notetaker.onrender.com`

ğŸ“– [Full Deployment Guide](docs/DEPLOYMENT.md)

### Option 2: Run Locally

**Prerequisites**:
- Python 3.11+
- 8GB RAM minimum
- 5GB storage for models

**Quick Setup**:
```bash
# Clone repository
git clone https://github.com/YOUR_USERNAME/physician-notetaker.git
cd physician-notetaker

# Create virtual environment
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
# .venv\Scripts\activate  # Windows

# Install dependencies
pip install -r requirements.txt

# Start application
python app.py
```

Access at: http://localhost:5000

âš ï¸ **First Run**: Models download automatically (takes 2-3 minutes)powershell
start_web.bat  # Windows
# ./start_web.sh  # Linux/Mac
```

**Manual Way**:
```powershell
python app.py
```

Then open your browser to: **http://localhost:5000**

#### Option B: Jupyter Notebook (For Development/Testing)

```powershell
jupyter notebook notebooks/production_pipeline.ipynb
```

#### Option C: Python Script

```powershell
python run_demo.py
```

### ğŸ”§ Troubleshooting

Having issues? See [TROUBLESHOOTING.md](TROUBLESHOOTING.md) for solutions to common problems.

## ğŸ“¦ Installation

### Standard Installation

```powershell
# Install all dependencies
pip install -r requirements.txt

# Install package in development mode
pip install -e .
```

### Optional Components

```powershell
# Scientific spaCy models for better medical NER
pip install en-core-sci-sm
pip install en-ner-bc5cdr-md

# Additional clinical models
pip install scispacy
```

### Verify Installation

```powershell
python -c "import torch; print(f'PyTorch: {torch.__version__}'); print(f'CUDA: {torch.cuda.is_available()}')"
```

Expected output:
```
PyTorch: 2.x.x
CUDA: True  # (or False if no GPU)
```

## ğŸ“– Usage

### Web Application

The easiest way to use Physician Notetaker is through the web interface.

1. **Start the server**:
   ```powershell
   python app.py
   ```

2. **Open browser**: Navigate to `http://localhost:5000`

3. **Analyze a transcript**:
   - Paste or type medical conversation
   - Click "Load Sample" for a demo transcript
   - Click "Analyze Transcript"
   - View SOAP note, summary, and extracted entities
   - Export results as JSON

**First-time load**: Models will download automatically (~2GB, 1-2 minutes)

For detailed web app documentation, see [README_WEB.md](README_WEB.md)

### Python Notebook

Interactive development and exploration:

```powershell
# Launch Jupyter
jupyter notebook

# Open: notebooks/production_pipeline.ipynb
```

The notebook includes:
- Step-by-step pipeline execution
- Model loading and configuration
- Entity extraction examples
- SOAP note generation
- FHIR conversion
- Custom input testing

### Command Line

Process transcripts programmatically:

```python
from physician_notetaker import (
    MedicalPreprocessor,
    MedicalNER,
    MedicalSummarizer,
    SOAPGenerator,
    SentimentIntentClassifier
)

# Load transcript
with open('data/examples/transcript_01.txt', 'r') as f:
    transcript = f.read()

# Initialize components
preprocessor = MedicalPreprocessor()
ner = MedicalNER(model_name="en_core_sci_sm")
summarizer = MedicalSummarizer()
soap_generator = SOAPGenerator()
sentiment = SentimentIntentClassifier()

# Process
preprocessed = preprocessor.preprocess(transcript)
entities = ner.extract_entities(transcript, preprocessed)
summary = summarizer.generate_summary(transcript, entities)
soap_note = soap_generator.generate_soap(transcript, entities)
sentiment_result = sentiment.classify(transcript)

# Use results
print(f"Summary: {summary}")
print(f"SOAP: {soap_note}")
print(f"Entities: {entities}")
```

## ğŸŒ Deployment

### Deploy to Render (Recommended)

This project is configured for one-click deployment to Render.

**Quick Deploy**:
1. Fork this repository
2. Click: [![Deploy to Render](https://render.com/images/deploy-to-render-button.svg)](https://render.com/deploy)
3. Connect your GitHub repo
4. Render auto-detects configuration from `render.yaml`
5. Wait 10-15 minutes for first deploy
6. Access at: `https://physician-notetaker.onrender.com`

**Configuration Files**:
- `render.yaml` - Service configuration
- `build.sh` - Build script
- `gunicorn.conf.py` - Production server settings
- `Procfile` - Process definition
- `runtime.txt` - Python version

**Environment**:
- Python 3.11
- Gunicorn WSGI server
- 10GB persistent disk for models
- Automatic SSL certificates

### Other Platforms

**Heroku**:
```bash
heroku create physician-notetaker
git push heroku main
```

**Railway**: Connect GitHub repo, Railway auto-detects Flask

**Docker**:
```bash
docker build -t physician-notetaker .
docker run -p 5000:5000 physician-notetaker
```

ğŸ“– **Full Guide**: [docs/DEPLOYMENT.md](docs/DEPLOYMENT.md)

## ğŸ“ Project Structure

```
physician-notetaker/
â”œâ”€â”€ app.py                         # Flask web application
â”œâ”€â”€ gunicorn.conf.py               # Production server config
â”œâ”€â”€ requirements.txt               # Python dependencies
â”œâ”€â”€ setup.py                       # Package setup
â”‚
â”œâ”€â”€ physician_notetaker/           # Core NLP package
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ ner.py                    # Named Entity Recognition
â”‚   â”œâ”€â”€ summarizer.py             # Clinical summarization
â”‚   â”œâ”€â”€ llm_summarizer.py         # LLM-based summarization
â”‚   â”œâ”€â”€ soap_generator.py         # SOAP note generation
â”‚   â”œâ”€â”€ sentiment.py              # Sentiment analysis
â”‚   â””â”€â”€ utils.py                  # Utilities
â”‚
â”œâ”€â”€ templates/                     # Web UI
â”‚   â””â”€â”€ index.html                # Main interface
â”‚
â”œâ”€â”€ static/                        # Frontend assets
â”‚   â”œâ”€â”€ style.css                 # Styling
â”‚   â””â”€â”€ script.js                 # JavaScript logic
â”‚
â”œâ”€â”€ notebooks/                     # Jupyter notebooks
â”‚   â”œâ”€â”€ production_pipeline.ipynb
â”‚   â””â”€â”€ demo_pipeline.ipynb
â”‚
â”œâ”€â”€ data/examples/                 # Sample transcripts
â”‚
â”œâ”€â”€ tests/                         # Unit tests
â”‚
â”œâ”€â”€ docs/                          # Documentation
â”‚   â”œâ”€â”€ DEPLOYMENT.md             # Deployment guide
â”‚   â”œâ”€â”€ WEB_INTERFACE.md          # Web app docs
â”‚   â””â”€â”€ TROUBLESHOOTING.md        # Common issues
â”‚
â”œâ”€â”€ Deployment Files
â”‚   â”œâ”€â”€ render.yaml               # Render configuration
â”‚   â”œâ”€â”€ build.sh                  # Build script
â”‚   â”œâ”€â”€ Procfile                  # Process file
â”‚   â”œâ”€â”€ runtime.txt               # Python version
â”‚   â””â”€â”€ .env.example              # Environment template
â”‚
â””â”€â”€ Scripts
    â”œâ”€â”€ start_web.bat             # Windows starter
    â”œâ”€â”€ start_web.sh              # Linux/Mac starter
    â””â”€â”€ start_dev.sh              # Development mode
```

## ğŸ¤– Models

### Transformer Models Used

| Component | Model | Purpose | Size |
|-----------|-------|---------|------|
| **NER** | `d4data/biomedical-ner-all` | Extract medical entities | ~500MB |
| **Fallback NER** | `dbmdz/bert-large-cased-finetuned-conll03-english` | General NER backup | ~440MB |
| **Classification** | `distilbert-base-uncased-finetuned-sst-2-english` | Sentiment analysis | ~268MB |
| **Generation** | `google/flan-t5-base` | Summarization & SOAP | ~990MB |
| **Optional** | `google/flan-t5-large` | Better quality (paid tier) | ~3GB |

**Total Size**: ~2.2GB (base models)
**First Load**: Models downloaded automatically from HuggingFace

### Model Performance

- **CPU Processing**: 5-15 seconds per transcript
- **GPU Processing**: 2-5 seconds per transcript
- **First Load**: 1-2 minutes (one-time model download)

## âš™ï¸ Configuration

### Environment Variables

Create a `.env` file in the project root:

```bash
# Model Selection
NER_MODEL=d4data/biomedical-ner-all
CLINICAL_BERT=emilyalsentzer/Bio_ClinicalBERT
FLAN_T5=google/flan-t5-base

# Generation Parameters
MAX_SUMMARY_LENGTH=300
MAX_SOAP_LENGTH=400
NUM_BEAMS=4
TEMPERATURE=0.7

# Server Settings
API_HOST=0.0.0.0
API_PORT=5000
```

### Model Configuration

Edit configuration in `app.py` or notebooks:

```python
CONFIG = {
    'NER_MODEL': "d4data/biomedical-ner-all",
    'CLINICAL_BERT': "emilyalsentzer/Bio_ClinicalBERT",
    'FLAN_T5': "google/flan-t5-base",
    'max_summary_length': 300,
    'max_soap_length': 400,
    'num_beams': 4,
    'temperature': 0.7,
}
```

## ğŸ”Œ API Documentation

### REST Endpoints

#### `GET /health`
Health check endpoint

**Response**:
```json
{
  "status": "healthy",
  "device": "GPU (CUDA)",
  "models_loaded": true
}
```

#### `POST /analyze`
Analyze medical transcript

**Request**:
```json
{
  "transcript": "Doctor: How are you feeling?\nPatient: I have a headache..."
}
```

**Response**:
```json
{
  "entities": {
    "Symptoms": ["headache", "nausea"],
    "Diagnosis": ["migraine"],
    "Treatment": ["sumatriptan"],
    "Medications": ["ibuprofen"]
  },
  "soap_note": {
    "Subjective": {"content": "Patient reports..."},
    "Objective": {"content": "Physical exam reveals..."},
    "Assessment": {"content": "Diagnosis: migraine..."},
    "Plan": {"content": "Prescribe sumatriptan..."}
  },
  "summary": "Patient presents with severe headaches...",
  "sentiment": {
    "sentiment": "neutral",
    "confidence": 0.87
  },
  "intent": {
    "intent": "consultation",
    "confidence": 0.92
  }
}
```

For complete API documentation, see [README_WEB.md](README_WEB.md)

## ğŸ“š Examples

### Example 1: Basic Analysis

```python
from physician_notetaker import MedicalNER

# Simple entity extraction
ner = MedicalNER()
text = "Patient has severe headache and nausea. Diagnosed with migraine."
entities = ner.extract_entities(text)

print(entities['structured'])
# Output:
# {
#   'Symptoms': ['headache', 'nausea'],
#   'Diagnosis': ['migraine']
# }
```

### Example 2: Complete Pipeline

See `run_demo.py` or `notebooks/production_pipeline.ipynb` for complete examples.

### Example 3: Web API

```javascript
// JavaScript fetch example
const response = await fetch('http://localhost:5000/analyze', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    transcript: "Doctor: How are you?..."
  })
});

const results = await response.json();
console.log(results.soap_note);
```

## ğŸ“Š Performance

### Benchmarks

Tested on:
- **CPU**: Intel i7-10700K
- **GPU**: NVIDIA RTX 3080
- **RAM**: 32GB

| Operation | CPU Time | GPU Time |
|-----------|----------|----------|
| Entity Extraction | 2-3s | 0.5-1s |
| SOAP Generation | 8-12s | 2-3s |
| Full Pipeline | 15-20s | 4-6s |

### Optimization Tips

1. **Use GPU**: Automatic CUDA detection, ~4x faster
2. **Batch Processing**: Process multiple transcripts together
3. **Model Selection**: Use `flan-t5-small` for speed, `flan-t5-large` for quality
4. **Cache Models**: Models load once and stay in memory

## ğŸ› Troubleshooting

### Common Issues

#### Models Not Loading

```powershell
# Clear cache and reinstall
pip install --upgrade --force-reinstall transformers torch
```

#### CUDA Out of Memory

```python
# In app.py, force CPU usage
DEVICE = -1  # Force CPU
```

Or use smaller models:
```python
CONFIG['FLAN_T5'] = "google/flan-t5-small"
```

#### Port Already in Use

```powershell
# Change port in app.py
app.run(debug=True, port=5001)  # Use different port
```

#### Slow First Request

This is normal! Models are downloaded and loaded on first use:
- Initial download: 1-2 minutes (one-time)
- Subsequent requests: Fast

## ğŸ“š Documentation

Comprehensive guides available in `/docs`:

- **[DEPLOYMENT.md](docs/DEPLOYMENT.md)** - Deploy to Render, Heroku, Docker
- **[WEB_INTERFACE.md](docs/WEB_INTERFACE.md)** - Web application guide
- **[TROUBLESHOOTING.md](docs/TROUBLESHOOTING.md)** - Common issues & fixes
- **[QUICK_START.md](QUICK_START.md)** - Quick reference guide

### Getting Help

1. Check relevant documentation above
2. Review [Issues](https://github.com/YOUR_USERNAME/physician-notetaker/issues)
3. See notebooks for examples
4. Run unit tests for verification

## ğŸ§ª Testing

Run the test suite:

```powershell
# Run all tests
pytest tests/

# Run with coverage
pytest tests/ --cov=physician_notetaker

# Run specific test
pytest tests/test_ner.py -v
```

## ğŸŒŸ Features in Detail

### Web Interface
- Modern, responsive design with medical theme
- Real-time transcript analysis
- Collapsible sections for organized output
- Entity extraction with visual indicators
- JSON export functionality
- Mobile-friendly layout

### Analysis Capabilities
- **Entity Extraction**: Symptoms, diagnoses, treatments, medications
- **SOAP Notes**: Automated clinical documentation
- **Summarization**: Concise clinical summaries
- **Sentiment Analysis**: Conversation tone detection
- **LLM Fallback**: Hybrid NER + LLM approach for accuracy

### Performance
- GPU acceleration (when available)
- Model caching for faster responses
- Lazy loading to reduce startup time
- Production-ready with Gunicorn

## âš ï¸ Important Disclaimers

### Medical Use Warning

ğŸ¥ **NOT FOR CLINICAL USE**: This application is for **demonstration and research purposes only**. It is NOT validated for clinical decision-making or patient care.

### Data Privacy

ğŸ”’ **PHI Handling**: If processing real patient data:
- Implement proper PHI redaction
- Ensure HIPAA compliance
- Use secure infrastructure
- Obtain necessary permissions

### AI Limitations

âš ï¸ AI models may:
- Produce incorrect information
- Miss important medical details
- Generate hallucinated content
- Require validation by healthcare professionals

**Always verify AI-generated content with qualified medical professionals.**

## ğŸ¤ Contributing

Contributions welcome! To contribute:

1. **Test in Notebook**: Validate changes in `notebooks/production_pipeline.ipynb`
2. **Update Core Modules**: Modify `physician_notetaker/` modules
3. **Update Web App**: Reflect changes in `app.py`
4. **Add Tests**: Include unit tests in `tests/`
5. **Document**: Update relevant documentation

## ğŸ“„ License

This project is provided as-is for educational and research purposes.

## ğŸ™ Acknowledgments

### Models & Libraries

- **Hugging Face** - Transformers library and model hosting
- **Google** - FLAN-T5 models
- **AllenAI** - SciSpacy and biomedical NLP tools
- **PyTorch** - Deep learning framework

### Medical NLP Community

- Bio_ClinicalBERT team
- i2b2 medical NLP challenges
- FHIR standards organization

## ğŸ“ Support

For issues, questions, or suggestions:

- ğŸ“ Review documentation files (README_WEB.md, LLM_GUIDE.md)
- ğŸ” Check existing issues and examples
- ğŸ’¡ Explore notebooks for working code samples

---

<div align="center">

**Built with â¤ï¸ using state-of-the-art medical NLP**

ğŸ¥ **Physician Notetaker** | Transforming Healthcare Documentation

</div>
